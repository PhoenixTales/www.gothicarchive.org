{% # aaa 1 %}

{%
# aaa 2
%}

{% # aaa 3 %}{%

# aaa 4

%}{% # aaa 5 %}
  
  
{% comment %}

This script defines variables that need to be used when writing URLs:
- wwwRoot    / wwwDir    (for page and text file URLs)
- audioRoot  / audioDir  (for audio URLs)
- binRoot    / binDir    (for URLs of files you can't open in the browser)
- imagesRoot / imagesDir (for image URLs)
- videosRoot / videosDir (for video URLs)
- wikiRoot   / wikiDir   (for wiki URLs)

Use Root variable for absolute URLs and Dir variable for URLs relative to current page.
For example: 
- "{{ wwwRoot }}/page.html" expands to "https://gothicarchive.org/page.html"
- "{{ wwwDir }}/page.html" when inside page "/articles/news" expands to "https://gothicarchive.org/articles/news/page.html"
- "{{ imagesDir }}/cover.jpg" when inside page "/articles/news" expands to "https://images/gothicarchive.org/articles/news/cover.jpg"

These URLs cannot be written directly in whole by hand, because we need the first part
to be different when page is loaded from our web domain (gothicarchive.org)
and different when loaded from local copy of archive (gothicarchive.zip).

This script is written in Liquid Template Language, documented at shopify.dev/docs/api/liquid .
We use it, because it is supported out-of-the-box by Jekyll, which is supported out-of-the-box by GitHub Pages.
In this language, every line of code has to be surrounded with "{ % -" and "- % }".
To make reading easier, we put both start and end at the end of the lines.

EXAMPLES OF BAD URL USE:
<a href="https://gothicarchive.org/page.html">Link</a> (will not work from offline .zip)
<img src="../images/picture.jpg"> (will not work from http .org)
<img src="{{ wwwDir }}/picture.jpg"> (image url but uses www variable)

EXAMPLES OF GOOD URL USE:
<a href="{{ wwwRoot }}/page.html">Link</a>
<img src="{{ imagesDir }}/picture.jpg">

{% endcomment %}{%



# first compute the path of the current directory, relative from the root %}{%

assign dirPath = "" %}{%
assign urlParts = page.url | split: '/' %}{%
assign dirDepth = urlParts | size | minus: 2 %}{%
for i in (1..dirDepth) %}{%
    assign dirPath = dirPath | append: '/' | append: urlParts[i] %}{%
endfor %}{%


# then compute different root URLs for online web mode and offline zip mode %}{%

if jekyll.environment == "production" %}{%

  # this means that archive is running in the online web mode %}{%

  assign rootDomain = "gothicarchive.org" %}{%

  assign wwwRoot    = "https://"        | append: rootDomain %}{%
  assign audioRoot  = "https://audio."  | append: rootDomain %}{%
  assign binRoot    = "https://bin."    | append: rootDomain %}{%
  assign imagesRoot = "https://images." | append: rootDomain %}{%
  assign videosRoot = "https://videos." | append: rootDomain %}{%
  assign wikiRoot   = "https://wiki."   | append: rootDomain %}{%

  # obsolete old domains (TODO remove) %}{%
  assign mediaRoot  = "https://media."  | append: rootDomain %}{%

else %}{%

  # this means that archive is running in the offline zip mode %}{%

  # first compute path of the zip root %}{%
  assign zipRoot = ".." %}{%
  assign zipRootSeparator = "/" %}{%
  for i in (2..dirDepth) %}{%
    assign zipRoot = zipRoot | append: "/.." %}{%
  endfor %}{%
  if dirDepth == 0 %}{%
    assign zipRoot = "" %}{%
    assign zipRootSeparator = "" %}{%
  endif %}{%

  assign wwwRoot    = zipRoot %}{%
  assign audioRoot  = zipRoot | append: zipRootSeparator | append: "audio" %}{%
  assign binRoot    = zipRoot | append: zipRootSeparator | append: "bin" %}{%
  assign imagesRoot = zipRoot | append: zipRootSeparator | append: "images" %}{%
  assign videosRoot = zipRoot | append: zipRootSeparator | append: "videos" %}{%
  assign wikiRoot   = zipRoot | append: zipRootSeparator | append: "wiki" %}{%

  # obsolete old domains (TODO remove) %}{%
  assign mediaRoot  = zipRoot | append: zipRootSeparator | append: "media" %}{%

endif %}{%


# directory URLs for both modes are based on their root URLs %}{%
assign wwwDir     = "." %}{%
assign audioDir   = audioRoot  | append: dirPath %}{%
assign binDir     = binRoot    | append: dirPath %}{%
assign imagesDir  = imagesRoot | append: dirPath %}{%
assign videosDir  = videosRoot | append: dirPath %}{%
assign wikiDir    = wikiRoot   | append: dirPath %}{%


# obsolete old domains (TODO remove) %}{%
assign mediaDir         = mediaRoot  | append: dirPath %}{%
assign absLinkBase      = wwwRoot %}{%
assign linkBase         = wwwDir %}{%
assign absMediaLinkBase = mediaRoot %}{%
assign mediaLinkBase    = mediaDir

%}
